<!DOCTYPE html><html><head><title>CCDIKSolver – three.js docs</title></head><body><body>
		<h1>CCDIKSolver</h1>

		<p class=/"desc/"> A solver for IK with <a href=/"https://sites.google.com/site/auraliusproject/ccd-algorithm/"><code class=/"inline prettyprint/" translate=/"no/"><span class=/"pln/">CCD </span><span class=/"typ/">Algorithm</span></code></a>. <br><br>
		CCDIKSolver solves Inverse Kinematics Problem with CCD Algorithm.
		CCDIKSolver is designed to work with <a class=/"links/" data-fragment=/"SkinnedMesh/" title=/"SkinnedMesh/" href=/"./index.html#api/en/objects/SkinnedMesh/">SkinnedMesh</a> but also can be used with <a class=/"links/" data-fragment=/"MMDLoader/" title=/"MMDLoader/" href=/"./index.html#examples/en/loaders/MMDLoader/">MMDLoader</a> or <a class=/"links/" data-fragment=/"GLTFLoader/" title=/"GLTFLoader/" href=/"./index.html#examples/en/loaders/GLTFLoader/">GLTFLoader</a> skeleton.
		</p>

		<iframe id=/"scene/" src=/"scenes/ccdiksolver-browser.html/"></iframe>

		<h2>Import</h2>

		<p>
			CCDIKSolver is an add-on, and must be imported explicitly.
			See <a href=/"#manual/introduction/Installation/" target=/"_blank/">Installation / Addons</a>.
		</p>

		<code class=/" prettyprint/" translate=/"no/"><span class=/"kwd/">import</span><span class=/"pln/"> </span><span class=/"pun/">{</span><span class=/"pln/"> </span><span class=/"typ/">CCDIKSolver</span><span class=/"pln/"> </span><span class=/"pun/">}</span><span class=/"pln/"> </span><span class=/"kwd/">from</span><span class=/"pln/"> </span><span class=/"str/">'three/addons/animation/CCDIKSolver.js'</span><span class=/"pun/">;</span></code>

		<h2>Code Example</h2>

		<code class=/" prettyprint/" translate=/"no/"><span class=/"pln/">let ikSolver</span><span class=/"pun/">;</span><span class=/"pln/">

</span><span class=/"com/">//</span><span class=/"pln/">
</span><span class=/"com/">// Bones hierarchy:</span><span class=/"pln/">
</span><span class=/"com/">//</span><span class=/"pln/">
</span><span class=/"com/">//   root</span><span class=/"pln/">
</span><span class=/"com/">//     ├── bone0</span><span class=/"pln/">
</span><span class=/"com/">//     │    └── bone1</span><span class=/"pln/">
</span><span class=/"com/">//     │          └── bone2</span><span class=/"pln/">
</span><span class=/"com/">//     │                └── bone3</span><span class=/"pln/">
</span><span class=/"com/">//     └── target</span><span class=/"pln/">
</span><span class=/"com/">//</span><span class=/"pln/">
</span><span class=/"com/">// Positioned as follow on the cylinder:</span><span class=/"pln/">
</span><span class=/"com/">//</span><span class=/"pln/">
</span><span class=/"com/">//        o      &lt;- target      (y =  20)</span><span class=/"pln/">
</span><span class=/"com/">//        </span><span class=/"pln/">
</span><span class=/"com/">//   +----o----+ &lt;- bone3       (y =  12)</span><span class=/"pln/">
</span><span class=/"com/">//   |         |</span><span class=/"pln/">
</span><span class=/"com/">//   |    o    | &lt;- bone2       (y =   4)</span><span class=/"pln/">
</span><span class=/"com/">//   |         |</span><span class=/"pln/">
</span><span class=/"com/">//   |    o    | &lt;- bone1       (y =  -4)</span><span class=/"pln/">
</span><span class=/"com/">//   |         |</span><span class=/"pln/">
</span><span class=/"com/">//   +----oo---+ &lt;- root, bone0 (y = -12)</span><span class=/"pln/">
</span><span class=/"com/">//</span><span class=/"pln/">

let bones </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"pun/">[]</span><span class=/"pln/">

</span><span class=/"com/">// /"root/"</span><span class=/"pln/">
let rootBone </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">Bone</span><span class=/"pun/">();</span><span class=/"pln/">
rootBone</span><span class=/"pun/">.</span><span class=/"pln/">position</span><span class=/"pun/">.</span><span class=/"pln/">y </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"pun/">-</span><span class=/"lit/">12</span><span class=/"pun/">;</span><span class=/"pln/">
bones</span><span class=/"pun/">.</span><span class=/"pln/">push</span><span class=/"pun/">(</span><span class=/"pln/"> rootBone </span><span class=/"pun/">);</span><span class=/"pln/">

</span><span class=/"com/">// /"bone0/"</span><span class=/"pln/">
let prevBone </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">Bone</span><span class=/"pun/">();</span><span class=/"pln/">
prevBone</span><span class=/"pun/">.</span><span class=/"pln/">position</span><span class=/"pun/">.</span><span class=/"pln/">y </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"lit/">0</span><span class=/"pun/">;</span><span class=/"pln/">
rootBone</span><span class=/"pun/">.</span><span class=/"pln/">add</span><span class=/"pun/">(</span><span class=/"pln/"> prevBone </span><span class=/"pun/">);</span><span class=/"pln/">
bones</span><span class=/"pun/">.</span><span class=/"pln/">push</span><span class=/"pun/">(</span><span class=/"pln/"> prevBone </span><span class=/"pun/">);</span><span class=/"pln/">

</span><span class=/"com/">// /"bone1/", /"bone2/", /"bone3/"</span><span class=/"pln/">
</span><span class=/"kwd/">for</span><span class=/"pln/"> </span><span class=/"pun/">(</span><span class=/"pln/"> let i </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"lit/">1</span><span class=/"pun/">;</span><span class=/"pln/"> i </span><span class=/"pun/">&lt;=</span><span class=/"pln/"> </span><span class=/"lit/">3</span><span class=/"pun/">;</span><span class=/"pln/"> i </span><span class=/"pun/">++</span><span class=/"pln/"> </span><span class=/"pun/">)</span><span class=/"pln/"> </span><span class=/"pun/">{</span><span class=/"pln/">
	</span><span class=/"kwd/">const</span><span class=/"pln/"> bone </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">Bone</span><span class=/"pun/">();</span><span class=/"pln/">
	bone</span><span class=/"pun/">.</span><span class=/"pln/">position</span><span class=/"pun/">.</span><span class=/"pln/">y </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"lit/">8</span><span class=/"pun/">;</span><span class=/"pln/">
	bones</span><span class=/"pun/">.</span><span class=/"pln/">push</span><span class=/"pun/">(</span><span class=/"pln/"> bone </span><span class=/"pun/">);</span><span class=/"pln/">
	
	prevBone</span><span class=/"pun/">.</span><span class=/"pln/">add</span><span class=/"pun/">(</span><span class=/"pln/"> bone </span><span class=/"pun/">);</span><span class=/"pln/">
	prevBone </span><span class=/"pun/">=</span><span class=/"pln/"> bone</span><span class=/"pun/">;</span><span class=/"pln/">
</span><span class=/"pun/">}</span><span class=/"pln/">

</span><span class=/"com/">// /"target/"</span><span class=/"pln/">
</span><span class=/"kwd/">const</span><span class=/"pln/"> targetBone </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">Bone</span><span class=/"pun/">();</span><span class=/"pln/">
targetBone</span><span class=/"pun/">.</span><span class=/"pln/">position</span><span class=/"pun/">.</span><span class=/"pln/">y </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"lit/">24</span><span class=/"pln/"> </span><span class=/"pun/">+</span><span class=/"pln/"> </span><span class=/"lit/">8</span><span class=/"pln/">
rootBone</span><span class=/"pun/">.</span><span class=/"pln/">add</span><span class=/"pun/">(</span><span class=/"pln/"> targetBone </span><span class=/"pun/">);</span><span class=/"pln/">
bones</span><span class=/"pun/">.</span><span class=/"pln/">push</span><span class=/"pun/">(</span><span class=/"pln/"> targetBone </span><span class=/"pun/">);</span><span class=/"pln/">

</span><span class=/"com/">//</span><span class=/"pln/">
</span><span class=/"com/">// skinned mesh</span><span class=/"pln/">
</span><span class=/"com/">//</span><span class=/"pln/">

</span><span class=/"kwd/">const</span><span class=/"pln/"> mesh </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">SkinnedMesh</span><span class=/"pun/">(</span><span class=/"pln/"> geometry</span><span class=/"pun/">,</span><span class=/"pln/">	material </span><span class=/"pun/">);</span><span class=/"pln/">
</span><span class=/"kwd/">const</span><span class=/"pln/"> skeleton </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">Skeleton</span><span class=/"pun/">(</span><span class=/"pln/"> bones </span><span class=/"pun/">);</span><span class=/"pln/">

mesh</span><span class=/"pun/">.</span><span class=/"pln/">add</span><span class=/"pun/">(</span><span class=/"pln/"> bones</span><span class=/"pun/">[</span><span class=/"pln/"> </span><span class=/"lit/">0</span><span class=/"pln/"> </span><span class=/"pun/">]</span><span class=/"pln/"> </span><span class=/"pun/">);</span><span class=/"pln/"> </span><span class=/"com/">// /"root/" bone</span><span class=/"pln/">
mesh</span><span class=/"pun/">.</span><span class=/"pln/">bind</span><span class=/"pun/">(</span><span class=/"pln/"> skeleton </span><span class=/"pun/">);</span><span class=/"pln/">

</span><span class=/"com/">//</span><span class=/"pln/">
</span><span class=/"com/">// ikSolver</span><span class=/"pln/">
</span><span class=/"com/">//</span><span class=/"pln/">

</span><span class=/"kwd/">const</span><span class=/"pln/"> iks </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"pun/">[</span><span class=/"pln/">
	</span><span class=/"pun/">{</span><span class=/"pln/">
		target</span><span class=/"pun/">:</span><span class=/"pln/"> </span><span class=/"lit/">5</span><span class=/"pun/">,</span><span class=/"pln/"> </span><span class=/"com/">// /"target/"</span><span class=/"pln/">
		effector</span><span class=/"pun/">:</span><span class=/"pln/"> </span><span class=/"lit/">4</span><span class=/"pun/">,</span><span class=/"pln/"> </span><span class=/"com/">// /"bone3/"</span><span class=/"pln/">
		links</span><span class=/"pun/">:</span><span class=/"pln/"> </span><span class=/"pun/">[</span><span class=/"pln/"> </span><span class=/"pun/">{</span><span class=/"pln/"> index</span><span class=/"pun/">:</span><span class=/"pln/"> </span><span class=/"lit/">3</span><span class=/"pln/"> </span><span class=/"pun/">},</span><span class=/"pln/"> </span><span class=/"pun/">{</span><span class=/"pln/"> index</span><span class=/"pun/">:</span><span class=/"pln/"> </span><span class=/"lit/">2</span><span class=/"pln/"> </span><span class=/"pun/">},</span><span class=/"pln/"> </span><span class=/"pun/">{</span><span class=/"pln/"> index</span><span class=/"pun/">:</span><span class=/"pln/"> </span><span class=/"lit/">1</span><span class=/"pln/"> </span><span class=/"pun/">}</span><span class=/"pln/"> </span><span class=/"pun/">]</span><span class=/"pln/"> </span><span class=/"com/">// /"bone2/", /"bone1/", /"bone0/"</span><span class=/"pln/">
	</span><span class=/"pun/">}</span><span class=/"pln/">
</span><span class=/"pun/">];</span><span class=/"pln/">
ikSolver </span><span class=/"pun/">=</span><span class=/"pln/"> </span><span class=/"kwd/">new</span><span class=/"pln/"> </span><span class=/"typ/">CCDIKSolver</span><span class=/"pun/">(</span><span class=/"pln/"> mesh</span><span class=/"pun/">,</span><span class=/"pln/"> iks </span><span class=/"pun/">);</span><span class=/"pln/">

</span><span class=/"kwd/">function</span><span class=/"pln/"> render</span><span class=/"pun/">()</span><span class=/"pln/"> </span><span class=/"pun/">{</span><span class=/"pln/">
	ikSolver</span><span class=/"pun/">?.</span><span class=/"pln/">update</span><span class=/"pun/">();</span><span class=/"pln/">
	renderer</span><span class=/"pun/">.</span><span class=/"pln/">render</span><span class=/"pun/">(</span><span class=/"pln/"> scene</span><span class=/"pun/">,</span><span class=/"pln/"> camera </span><span class=/"pun/">);</span><span class=/"pln/">
</span><span class=/"pun/">}</span></code>

		<h2>Examples</h2>

		<p>
			<a href=/"../examples/#webgl_animation_skinning_ik/" target=/"_blank/">webgl_animation_skinning_ik</a><br>
			<a href=/"../examples/#webgl_loader_mmd/" target=/"_blank/">webgl_loader_mmd</a><br>
			<a href=/"../examples/#webgl_loader_mmd_pose/" target=/"_blank/">webgl_loader_mmd_pose</a><br>
			<a href=/"../examples/#webgl_loader_mmd_audio/" target=/"_blank/">webgl_loader_mmd_audio</a>
		</p>

		<h2>Constructor</h2>

		<h3>CCDIKSolver( mesh : <a class=/"param links/" data-fragment=/"SkinnedMesh/" href=/"./index.html#api/en/objects/SkinnedMesh/">SkinnedMesh</a>, iks : <span class=/"param/">Array</span> )</h3>
		<p>
		<a class=/"links/" data-fragment=/"SkinnedMesh/" title=/"SkinnedMesh/" href=/"./index.html#api/en/objects/SkinnedMesh/">mesh</a> — <a class=/"links/" data-fragment=/"SkinnedMesh/" title=/"SkinnedMesh/" href=/"./index.html#api/en/objects/SkinnedMesh/">SkinnedMesh</a> for which CCDIKSolver solves IK problem.<br>
		<a class=/"links/" data-fragment=/"Array/" title=/"Array/">iks</a> — An array of <a class=/"links/" data-fragment=/"Object/" title=/"Object/">Object</a> specifying IK parameter. target, effector, and link-index are index integers in .skeleton.bones.
		The bones relation should be /"links[ n ], links[ n - 1 ], ..., links[ 0 ], effector/" in order from parent to child.<br>
		</p>
		<ul>
			<li><a class=/"links/" data-fragment=/"Integer/" title=/"Integer/">target</a> — Target bone.</li>
			<li><a class=/"links/" data-fragment=/"Integer/" title=/"Integer/">effector</a> — Effector bone.</li>
			<li><a class=/"links/" data-fragment=/"Array/" title=/"Array/">links</a> — An array of <a class=/"links/" data-fragment=/"Object/" title=/"Object/">Object</a> specifying link bones.
			<ul>
				<li><a class=/"links/" data-fragment=/"Integer/" title=/"Integer/">index</a> — Link bone.</li>
				<li><a class=/"links/" data-fragment=/"Vector3/" title=/"Vector3/" href=/"./index.html#api/en/math/Vector3/">limitation</a> — (optional) Rotation axis. Default is undefined.</li>
				<li><a class=/"links/" data-fragment=/"Vector3/" title=/"Vector3/" href=/"./index.html#api/en/math/Vector3/">rotationMin</a> — (optional) Rotation minimum limit. Default is undefined.</li>
				<li><a class=/"links/" data-fragment=/"Vector3/" title=/"Vector3/" href=/"./index.html#api/en/math/Vector3/">rotationMax</a> — (optional) Rotation maximum limit. Default is undefined.</li>
				<li><a class=/"links/" data-fragment=/"Boolean/" title=/"Boolean/">enabled</a> — (optional) Default is true.</li>
			</ul>
			</li>
			<li><a class=/"links/" data-fragment=/"Integer/" title=/"Integer/">iteration</a> — (optional) Iteration number of calculation. Smaller is faster but less precise. Default is 1.</li>
			<li><a class=/"links/" data-fragment=/"Number/" title=/"Number/">minAngle</a> — (optional) Minimum rotation angle in a step. Default is undefined.</li>
			<li><a class=/"links/" data-fragment=/"Number/" title=/"Number/">maxAngle</a> — (optional) Maximum rotation angle in a step. Default is undefined.</li>
		</ul>
		<p>
		Creates a new CCDIKSolver.
		</p>

		<h2>Properties</h2>

		<h3><a class=/"permalink links/" data-fragment=/"CCDIKSolver.iks/" target=/"_parent/" title=/"CCDIKSolver.iks/" href=/"./index.html#examples/en/animations/CCDIKSolver.iks/">#</a> .<a class=/"links/" data-fragment=/"CCDIKSolver.iks/" id=/"iks/" href=/"./index.html#examples/en/animations/CCDIKSolver.iks/">iks</a>  : <span class=/"param/">Array</span></h3>
		<p>An array of IK parameter passed to the constructor.</p>

		<h3><a class=/"permalink links/" data-fragment=/"CCDIKSolver.mesh/" target=/"_parent/" title=/"CCDIKSolver.mesh/" href=/"./index.html#examples/en/animations/CCDIKSolver.mesh/">#</a> .<a class=/"links/" data-fragment=/"CCDIKSolver.mesh/" id=/"mesh/" href=/"./index.html#examples/en/animations/CCDIKSolver.mesh/">mesh</a>  : <a class=/"param links/" data-fragment=/"SkinnedMesh/" href=/"./index.html#api/en/objects/SkinnedMesh/">SkinnedMesh</a></h3>
		<p><a class=/"links/" data-fragment=/"SkinnedMesh/" title=/"SkinnedMesh/" href=/"./index.html#api/en/objects/SkinnedMesh/">SkinnedMesh</a> passed to the constructor.</p>

		<h2>Methods</h2>

		<h3><a class=/"permalink links/" data-fragment=/"CCDIKSolver.createHelper/" target=/"_parent/" title=/"CCDIKSolver.createHelper/" href=/"./index.html#examples/en/animations/CCDIKSolver.createHelper/">#</a> .<a class=/"links/" data-fragment=/"CCDIKSolver.createHelper/" id=/"createHelper/" href=/"./index.html#examples/en/animations/CCDIKSolver.createHelper/">createHelper</a> () : <a class=/"param links/" data-fragment=/"CCDIKHelper/">CCDIKHelper</a></h3>
		<p>
		Return <a class=/"links/" data-fragment=/"CCDIKHelper/" title=/"CCDIKHelper/">CCDIKHelper</a>. You can visualize IK bones by adding the helper to scene.
		</p>

		<h3><a class=/"permalink links/" data-fragment=/"CCDIKSolver.update/" target=/"_parent/" title=/"CCDIKSolver.update/" href=/"./index.html#examples/en/animations/CCDIKSolver.update/">#</a> .<a class=/"links/" data-fragment=/"CCDIKSolver.update/" id=/"update/" href=/"./index.html#examples/en/animations/CCDIKSolver.update/">update</a> () : <span class=/"param/">this</span></h3>
		<p>
		Update IK bones quaternion by solving CCD algorithm.
		</p>

		<h3><a class=/"permalink links/" data-fragment=/"CCDIKSolver.updateOne/" target=/"_parent/" title=/"CCDIKSolver.updateOne/" href=/"./index.html#examples/en/animations/CCDIKSolver.updateOne/">#</a> .<a class=/"links/" data-fragment=/"CCDIKSolver.updateOne/" id=/"updateOne/" href=/"./index.html#examples/en/animations/CCDIKSolver.updateOne/">updateOne</a> ( ikParam : <span class=/"param/">Object</span> ) : <span class=/"param/">this</span></h3>
		<p>
		Update an IK bone quaternion by solving CCD algorithm.
		</p>

		<h2>Source</h2>

		<p>
			<a href=/"https://github.com/mrdoob/three.js/blob/master/examples/jsm/animation/CCDIKSolver.js/" target=/"_blank/">examples/jsm/animation/CCDIKSolver.js</a>
		</p>
	

<div id=/"button/"><img src=/"../files/ic_mode_edit_black_24dp.svg/"></div></body></body></html>