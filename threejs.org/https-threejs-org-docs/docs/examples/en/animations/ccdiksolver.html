<div id="readability-page-1" class="page"><div>
		<meta charset="utf-8">
		<base href="../../../">
		
		
	
	
		

		

		

		<h2>Import</h2>

		<p>
			CCDIKSolver is an add-on, and must be imported explicitly.
			See <a href="#manual/introduction/Installation" target="_blank">Installation / Addons</a>.
		</p>

		<p><code translate="no"><span>import</span><span> </span><span>{</span><span> </span><span>CCDIKSolver</span><span> </span><span>}</span><span> </span><span>from</span><span> </span><span>'three/addons/animation/CCDIKSolver.js'</span><span>;</span></code></p><h2>Code Example</h2>

		<p><code translate="no"><span>let ikSolver</span><span>;</span><span>

</span><span>//</span><span>
</span><span>// Bones hierarchy:</span><span>
</span><span>//</span><span>
</span><span>//   root</span><span>
</span><span>//     ├── bone0</span><span>
</span><span>//     │    └── bone1</span><span>
</span><span>//     │          └── bone2</span><span>
</span><span>//     │                └── bone3</span><span>
</span><span>//     └── target</span><span>
</span><span>//</span><span>
</span><span>// Positioned as follow on the cylinder:</span><span>
</span><span>//</span><span>
</span><span>//        o      &lt;- target      (y =  20)</span><span>
</span><span>//        </span><span>
</span><span>//   +----o----+ &lt;- bone3       (y =  12)</span><span>
</span><span>//   |         |</span><span>
</span><span>//   |    o    | &lt;- bone2       (y =   4)</span><span>
</span><span>//   |         |</span><span>
</span><span>//   |    o    | &lt;- bone1       (y =  -4)</span><span>
</span><span>//   |         |</span><span>
</span><span>//   +----oo---+ &lt;- root, bone0 (y = -12)</span><span>
</span><span>//</span><span>

let bones </span><span>=</span><span> </span><span>[]</span><span>

</span><span>// "root"</span><span>
let rootBone </span><span>=</span><span> </span><span>new</span><span> </span><span>Bone</span><span>();</span><span>
rootBone</span><span>.</span><span>position</span><span>.</span><span>y </span><span>=</span><span> </span><span>-</span><span>12</span><span>;</span><span>
bones</span><span>.</span><span>push</span><span>(</span><span> rootBone </span><span>);</span><span>

</span><span>// "bone0"</span><span>
let prevBone </span><span>=</span><span> </span><span>new</span><span> </span><span>Bone</span><span>();</span><span>
prevBone</span><span>.</span><span>position</span><span>.</span><span>y </span><span>=</span><span> </span><span>0</span><span>;</span><span>
rootBone</span><span>.</span><span>add</span><span>(</span><span> prevBone </span><span>);</span><span>
bones</span><span>.</span><span>push</span><span>(</span><span> prevBone </span><span>);</span><span>

</span><span>// "bone1", "bone2", "bone3"</span><span>
</span><span>for</span><span> </span><span>(</span><span> let i </span><span>=</span><span> </span><span>1</span><span>;</span><span> i </span><span>&lt;=</span><span> </span><span>3</span><span>;</span><span> i </span><span>++</span><span> </span><span>)</span><span> </span><span>{</span><span>
	</span><span>const</span><span> bone </span><span>=</span><span> </span><span>new</span><span> </span><span>Bone</span><span>();</span><span>
	bone</span><span>.</span><span>position</span><span>.</span><span>y </span><span>=</span><span> </span><span>8</span><span>;</span><span>
	bones</span><span>.</span><span>push</span><span>(</span><span> bone </span><span>);</span><span>
	
	prevBone</span><span>.</span><span>add</span><span>(</span><span> bone </span><span>);</span><span>
	prevBone </span><span>=</span><span> bone</span><span>;</span><span>
</span><span>}</span><span>

</span><span>// "target"</span><span>
</span><span>const</span><span> targetBone </span><span>=</span><span> </span><span>new</span><span> </span><span>Bone</span><span>();</span><span>
targetBone</span><span>.</span><span>position</span><span>.</span><span>y </span><span>=</span><span> </span><span>24</span><span> </span><span>+</span><span> </span><span>8</span><span>
rootBone</span><span>.</span><span>add</span><span>(</span><span> targetBone </span><span>);</span><span>
bones</span><span>.</span><span>push</span><span>(</span><span> targetBone </span><span>);</span><span>

</span><span>//</span><span>
</span><span>// skinned mesh</span><span>
</span><span>//</span><span>

</span><span>const</span><span> mesh </span><span>=</span><span> </span><span>new</span><span> </span><span>SkinnedMesh</span><span>(</span><span> geometry</span><span>,</span><span>	material </span><span>);</span><span>
</span><span>const</span><span> skeleton </span><span>=</span><span> </span><span>new</span><span> </span><span>Skeleton</span><span>(</span><span> bones </span><span>);</span><span>

mesh</span><span>.</span><span>add</span><span>(</span><span> bones</span><span>[</span><span> </span><span>0</span><span> </span><span>]</span><span> </span><span>);</span><span> </span><span>// "root" bone</span><span>
mesh</span><span>.</span><span>bind</span><span>(</span><span> skeleton </span><span>);</span><span>

</span><span>//</span><span>
</span><span>// ikSolver</span><span>
</span><span>//</span><span>

</span><span>const</span><span> iks </span><span>=</span><span> </span><span>[</span><span>
	</span><span>{</span><span>
		target</span><span>:</span><span> </span><span>5</span><span>,</span><span> </span><span>// "target"</span><span>
		effector</span><span>:</span><span> </span><span>4</span><span>,</span><span> </span><span>// "bone3"</span><span>
		links</span><span>:</span><span> </span><span>[</span><span> </span><span>{</span><span> index</span><span>:</span><span> </span><span>3</span><span> </span><span>},</span><span> </span><span>{</span><span> index</span><span>:</span><span> </span><span>2</span><span> </span><span>},</span><span> </span><span>{</span><span> index</span><span>:</span><span> </span><span>1</span><span> </span><span>}</span><span> </span><span>]</span><span> </span><span>// "bone2", "bone1", "bone0"</span><span>
	</span><span>}</span><span>
</span><span>];</span><span>
ikSolver </span><span>=</span><span> </span><span>new</span><span> </span><span>CCDIKSolver</span><span>(</span><span> mesh</span><span>,</span><span> iks </span><span>);</span><span>

</span><span>function</span><span> render</span><span>()</span><span> </span><span>{</span><span>
	ikSolver</span><span>?.</span><span>update</span><span>();</span><span>
	renderer</span><span>.</span><span>render</span><span>(</span><span> scene</span><span>,</span><span> camera </span><span>);</span><span>
</span><span>}</span></code></p><h2>Examples</h2>

		<p>
			<a href="https://threejs.org/examples/#webgl_animation_skinning_ik" target="_blank">webgl_animation_skinning_ik</a><br>
			<a href="https://threejs.org/examples/#webgl_loader_mmd" target="_blank">webgl_loader_mmd</a><br>
			<a href="https://threejs.org/examples/#webgl_loader_mmd_pose" target="_blank">webgl_loader_mmd_pose</a><br>
			<a href="https://threejs.org/examples/#webgl_loader_mmd_audio" target="_blank">webgl_loader_mmd_audio</a>
		</p>

		<h2>Constructor</h2>

		<h3>CCDIKSolver( mesh : <a data-fragment="SkinnedMesh" href="https://threejs.org/docs/index.html#api/en/objects/SkinnedMesh">SkinnedMesh</a>, iks : <span>Array</span> )</h3>
		<p>
		<a data-fragment="SkinnedMesh" title="SkinnedMesh" href="https://threejs.org/docs/index.html#api/en/objects/SkinnedMesh">mesh</a> — <a data-fragment="SkinnedMesh" title="SkinnedMesh" href="https://threejs.org/docs/index.html#api/en/objects/SkinnedMesh">SkinnedMesh</a> for which CCDIKSolver solves IK problem.<br>
		<a data-fragment="Array" title="Array">iks</a> — An array of <a data-fragment="Object" title="Object">Object</a> specifying IK parameter. target, effector, and link-index are index integers in .skeleton.bones.
		The bones relation should be "links[ n ], links[ n - 1 ], ..., links[ 0 ], effector" in order from parent to child.<br>
		</p>
		<ul>
			<li><a data-fragment="Integer" title="Integer">target</a> — Target bone.</li>
			<li><a data-fragment="Integer" title="Integer">effector</a> — Effector bone.</li>
			<li><a data-fragment="Array" title="Array">links</a> — An array of <a data-fragment="Object" title="Object">Object</a> specifying link bones.
			<ul>
				<li><a data-fragment="Integer" title="Integer">index</a> — Link bone.</li>
				<li><a data-fragment="Vector3" title="Vector3" href="https://threejs.org/docs/index.html#api/en/math/Vector3">limitation</a> — (optional) Rotation axis. Default is undefined.</li>
				<li><a data-fragment="Vector3" title="Vector3" href="https://threejs.org/docs/index.html#api/en/math/Vector3">rotationMin</a> — (optional) Rotation minimum limit. Default is undefined.</li>
				<li><a data-fragment="Vector3" title="Vector3" href="https://threejs.org/docs/index.html#api/en/math/Vector3">rotationMax</a> — (optional) Rotation maximum limit. Default is undefined.</li>
				<li><a data-fragment="Boolean" title="Boolean">enabled</a> — (optional) Default is true.</li>
			</ul>
			</li>
			<li><a data-fragment="Integer" title="Integer">iteration</a> — (optional) Iteration number of calculation. Smaller is faster but less precise. Default is 1.</li>
			<li><a data-fragment="Number" title="Number">minAngle</a> — (optional) Minimum rotation angle in a step. Default is undefined.</li>
			<li><a data-fragment="Number" title="Number">maxAngle</a> — (optional) Maximum rotation angle in a step. Default is undefined.</li>
		</ul>
		<p>
		Creates a new CCDIKSolver.
		</p>

		<h2>Properties</h2>

		<h3><a data-fragment="CCDIKSolver.iks" target="_parent" title="CCDIKSolver.iks" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.iks">#</a> .<a data-fragment="CCDIKSolver.iks" id="iks" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.iks">iks</a>  : <span>Array</span></h3>
		<p>An array of IK parameter passed to the constructor.</p>

		<h3><a data-fragment="CCDIKSolver.mesh" target="_parent" title="CCDIKSolver.mesh" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.mesh">#</a> .<a data-fragment="CCDIKSolver.mesh" id="mesh" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.mesh">mesh</a>  : <a data-fragment="SkinnedMesh" href="https://threejs.org/docs/index.html#api/en/objects/SkinnedMesh">SkinnedMesh</a></h3>
		<p><a data-fragment="SkinnedMesh" title="SkinnedMesh" href="https://threejs.org/docs/index.html#api/en/objects/SkinnedMesh">SkinnedMesh</a> passed to the constructor.</p>

		<h2>Methods</h2>

		<h3><a data-fragment="CCDIKSolver.createHelper" target="_parent" title="CCDIKSolver.createHelper" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.createHelper">#</a> .<a data-fragment="CCDIKSolver.createHelper" id="createHelper" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.createHelper">createHelper</a> () : <a data-fragment="CCDIKHelper">CCDIKHelper</a></h3>
		<p>
		Return <a data-fragment="CCDIKHelper" title="CCDIKHelper">CCDIKHelper</a>. You can visualize IK bones by adding the helper to scene.
		</p>

		<h3><a data-fragment="CCDIKSolver.update" target="_parent" title="CCDIKSolver.update" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.update">#</a> .<a data-fragment="CCDIKSolver.update" id="update" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.update">update</a> () : <span>this</span></h3>
		<p>
		Update IK bones quaternion by solving CCD algorithm.
		</p>

		<h3><a data-fragment="CCDIKSolver.updateOne" target="_parent" title="CCDIKSolver.updateOne" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.updateOne">#</a> .<a data-fragment="CCDIKSolver.updateOne" id="updateOne" href="https://threejs.org/docs/index.html#examples/en/animations/CCDIKSolver.updateOne">updateOne</a> ( ikParam : <span>Object</span> ) : <span>this</span></h3>
		<p>
		Update an IK bone quaternion by solving CCD algorithm.
		</p>

		<h2>Source</h2>

		<p>
			<a href="https://github.com/mrdoob/three.js/blob/master/examples/jsm/animation/CCDIKSolver.js" target="_blank">examples/jsm/animation/CCDIKSolver.js</a>
		</p>
	

<p><img src="https://threejs.org/files/ic_mode_edit_black_24dp.svg"></p></div></div>